"use strict"; function transformMessage(text, id) { try { const reglink = /([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi; let match; var links = []; while ((match = reglink.exec(text)) !== null) { isthere = false; for (link of links) { if (link === match[0].trim()) { isthere = true; break } } if (!isthere) { links.push(match[0].trim()) } } for (l of links) { var imgreg = /(http(s?):)([/|.|\w|\s|-])*\.(?:jpg|gif|png|jpeg)/g; if (imgreg.test(l)) { let img = "<a href='" + l + "' target='_blank'><img src='" + l + "' class='img-fluid d-block mt-1 mb-1 img-thumbnail' style='width:300px; '/></a>"; text = text.replaceAllOccurence(l, img, true) } else { let anchor = "<a href='" + l + "' target='_blank'>" + l + "</a>"; text = text.replaceAllOccurence(l, anchor, true) } } } catch (err) { console.log(err) } return text } String.prototype.replaceAllOccurence = function (str1, str2, ignore) { return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), ignore ? "gi" : "g"), typeof str2 == "string" ? str2.replace(/\$/g, "$$$$") : str2) };