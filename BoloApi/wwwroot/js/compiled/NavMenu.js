"use strict"; function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }) } else { obj[key] = value } return obj } class NavMenu extends React.Component { constructor(props) { super(props); const token = localStorage.getItem("token"); let loggedin = true; if (localStorage.getItem("token") == null) { loggedin = false } this.toggleNavbar = this.toggleNavbar.bind(this); this.state = { loggedin: loggedin, collapsed: true, registermodal: this.props.register === undefined ? false : this.props.register, showinvite: this.props.onInvite === undefined ? false : true, showleavemeeting: this.props.onLeaveMeeting === undefined ? false : true, onProfileChange: this.props.onProfileChange === undefined ? null : this.props.onProfileChange, registerFormBeginWith: this.props.registerFormBeginWith === undefined ? true : this.props.registerFormBeginWith, membername: localStorage.getItem("membername") !== null ? localStorage.getItem("membername") : '', memberpic: localStorage.getItem("memberpic") !== null ? localStorage.getItem("memberpic") : '', memberid: '', fixed: this.props.fixed === undefined ? true : this.props.fixed, showprofilemodal: false }; if (token !== null) { this.fetchData(token) } this.loginHandler = this.loginHandler.bind(this); this.handleRegister = this.handleRegister.bind(this); this.handleLogin = this.handleLogin.bind(this); this.closeRegisterModal = this.closeRegisterModal.bind(this); this.toggleProfileModal = this.toggleProfileModal.bind(this); this.handleProfileChange = this.handleProfileChange.bind(this) } loginHandler() { if (localStorage.getItem("token") != null) { this.fetchData(localStorage.getItem("token")); this.setState({ loggedin: true, registermodal: false, registerFormBeginWith: false }); if (this.props.onLogin !== undefined) { this.props.onLogin() } } } handleProfileChange() { if (this.state.onProfileChange !== null) { this.state.onProfileChange() } if (localStorage.getItem("token") !== null) { this.fetchData(localStorage.getItem("token")) } } handleRegister(e) { e.preventDefault(); this.setState({ registermodal: true, registerFormBeginWith: true }) } handleLogin(e) { e.preventDefault(); this.setState({ registermodal: true, registerFormBeginWith: false }) } handleLogout(e) { e.preventDefault(); localStorage.clear(); location.reload() } toggleProfileModal() { this.setState({ showprofilemodal: !this.state.showprofilemodal }) } closeRegisterModal() { this.setState({ registermodal: false }) } fetchData(t) { fetch('//' + window.location.host + '/api/Members/Validate', { method: 'get', headers: { 'Authorization': 'Bearer ' + t } }).then(response => { if (response.status === 401) { localStorage.removeItem("token"); localStorage.setItem("membername", ""); localStorage.setItem("memberpic", ""); this.setState({ bsstyle: 'danger', message: "Authorization has been denied for this request.", loggedin: false, loading: false, membername: '' }) } else if (response.status === 200) { response.json().then(data => { localStorage.setItem("membername", data.name); localStorage.setItem("memberpic", data.pic); this.setState({ bsstyle: '', message: "", loggedin: true, loading: false, membername: data.name, memberid: data.id, memberpic: data.pic }) }) } }) } toggleNavbar() { this.setState({ collapsed: !this.state.collapsed }) } static getDerivedStateFromProps(nextProps, prevState) { if (nextProps.register !== prevState.register) { return { registermodal: nextProps.register } } else { return null } } renderRegisterModal() { if (this.state.registermodal) { return React.createElement("div", { className: "modal d-block", "data-backdrop": "static", "data-keyboard": "false", tabIndex: "-1", role: "dialog", "aria-labelledby": "staticBackdropLabel", "aria-hidden": "true" }, React.createElement("div", { className: "modal-dialog" }, React.createElement("div", { className: "modal-content" }, React.createElement("div", { className: "modal-body" }, React.createElement("button", { type: "button", className: "btn-close float-end", "data-bs-dismiss": "modal", "aria-label": "Close", onClick: this.closeRegisterModal }), React.createElement(RegisterForm, { onLogin: this.loginHandler, beginWithRegister: this.state.registerFormBeginWith }))))) } else { return null } } renderProfileModal() { if (this.state.showprofilemodal) { return React.createElement("div", { className: "modal d-block", "data-backdrop": "static", "data-keyboard": "false", tabIndex: "-1", role: "dialog", "aria-labelledby": "staticBackdropLabel", "aria-hidden": "true" }, React.createElement("div", { className: "modal-dialog modal-fullscreen" }, React.createElement("div", { className: "modal-content" }, React.createElement("div", { className: "modal-header" }, React.createElement("h5", { className: "modal-title" }, "Profile Information"), React.createElement("button", { type: "button", className: "btn-close", "data-bs-dismiss": "modal", "aria-label": "Close", onClick: this.toggleProfileModal })), React.createElement(ManageProfile, { onProfileChange: this.handleProfileChange })))) } else { return null } } render() { const token = localStorage.getItem("token"); let linkitems = []; let loggedin = true; let navclassnames = "navbar navbar-expand-lg navbar-dark bg-dark " + (this.state.fixed ? "fixed-top" : ""); if (token === null) { loggedin = false } let profilepic = null; if (loggedin && this.state.memberpic !== "") { profilepic = React.createElement("img", { src: this.state.memberpic, width: "20", height: "20", className: "rounded-circle" }) } if (loggedin) { linkitems.push(React.createElement("button", { key: "memberlinkli", type: "button", className: "btn btn-dark me-2 membernavlink", onClick: this.toggleProfileModal }, profilepic, " ", this.state.membername)); linkitems.push(React.createElement("button", { key: "logoutlinkli", type: "button", className: "btn btn-dark", title: "Sign out", onClick: this.handleLogout }, React.createElement("i", { className: "bi bi-power" }))) } else { linkitems.push(React.createElement("button", { key: "loginlinkli", type: "button", className: "btn btn-dark me-2", onClick: this.handleLogin }, "Login")); linkitems.push(React.createElement("button", { key: "registerlinkli", type: "button", className: "btn btn-dark", onClick: this.handleRegister }, "Register")) } return React.createElement(React.Fragment, null, React.createElement("div", { className: "container-fluid bg-dark" }, React.createElement("header", { className: "d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-1 " }, React.createElement("a", { href: "/", className: "d-flex align-items-center col-md-3 mb-2 mb-md-0 text-white text-decoration-none" }, "Waarta"), React.createElement("ul", { className: "nav col-12 col-md-auto mb-2 justify-content-center mb-md-0" }, React.createElement("li", null, React.createElement("a", { className: "nav-link px-2 text-white", href: "/faq", title: "Frequently Asked Questions" }, React.createElement("i", { className: "bi bi-patch-question" }))), React.createElement("li", null, React.createElement("a", { className: "nav-link px-2 text-white", href: "/privacy", title: "Privacy" }, React.createElement("i", { className: "bi bi-eye-slash-fill" }))), React.createElement("li", null, React.createElement("a", { className: "nav-link px-2 text-white", href: "/Chat", title: "Chat" }, React.createElement("i", { className: "bi bi-chat-dots" }))), React.createElement("li", null, React.createElement("a", { className: "nav-link px-2 text-white", href: "/Discussions", title: "Discussion" }, React.createElement("i", { className: "bi bi-people-fill" })))), React.createElement("div", { className: "col-md-3 text-end" }, linkitems))), this.renderProfileModal(), this.renderRegisterModal()) } } _defineProperty(NavMenu, "displayName", NavMenu.name);